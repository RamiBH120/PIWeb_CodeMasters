pipeline{
  agent any
   
  stages {

  stage('Install dependencies') {
      steps{
        dir('backend'){
          
         sh 'npm install'

        }
      }
    }

    stage('SonarQube Analysis') { 
      steps{ 
        script { 
          def scannerHome = tool 'scanner'
          withSonarQubeEnv { 
            sh "${scannerHome}/bin/sonar-scanner" 
            } 
          } 
        } 
      }

    stage('Build application') {
         steps{ 
            dir('backend'){
                sh 'npm run build'
         }
      }
  }

  stage('Building image with Docker (node)') { 
        steps{
            dir('backend'){
                sh 'docker build -t ramibh120/pibackend:1.0.0 .'
         }
         //script { sh('docker-compose build') }
      } 
    }
  }
}